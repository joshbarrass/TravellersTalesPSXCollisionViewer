//////Travellers Tales RAW decompression tool by @Juanmv94////////

#include<stdio.h>
#include<stdlib.h>
#include<string.h>

const unsigned char decoderawfunc[993] =
{
    0x8B, 0x44, 0x24, 0x04, 0x81, 0xEC, 0x88, 0x00, 0x00, 0x00, 0x53, 0x55, 0x56, 0x8D, 0x70, 0x0E, 0x8D, 0x84, 0x24, 0x8D, 0x00, 0x00, 0x00, 0x57, 0x8B, 0xBC, 0x24, 0xA0, 0x00, 0x00, 0x00, 0x66, 0xC7, 0x00, 0x00, 0x00, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04, 0x85, 0x02, 0x00, 0x00, 0x00, 0x03, 0xC0, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x75, 0x14, 0x33, 0xC9, 0x03, 0xC0,
    0x8A, 0x0E, 0x46, 0x88, 0x0F, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x47, 0x83, 0xE1, 0x01, 0x74, 0x14, 0x25, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x17, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04, 0x41, 0xF6, 0xC4, 0x01, 0x75, 0x0A, 0x33, 0xC9, 0x8A, 0x0E, 0x46, 0x88, 0x0F, 0x47, 0xEB, 0xC2, 0x8D, 0x0C, 0x00, 0x33, 0xED, 0x8B, 0xC1, 0xBB, 0x02, 0x00, 0x00, 0x00, 0xC1, 0xE8, 0x08, 0x83, 0xE0, 0x01,
    0x81, 0xE1, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x12, 0x33, 0xC9, 0x8A, 0x0E, 0x46, 0x8D, 0x0C, 0x48, 0x8B, 0xD1, 0xC1, 0xEA, 0x08, 0x83, 0xE2, 0x01, 0x8B, 0xC2, 0x85, 0xC0, 0x0F, 0x85, 0xFF, 0x00, 0x00, 0x00, 0x03, 0xC9, 0x8B, 0xD9, 0xC1, 0xEB, 0x08, 0x83, 0xE3, 0x01, 0x81, 0xE1, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x10, 0x8A, 0x06, 0x46, 0x8D, 0x0C, 0x43, 0x8B, 0xC1, 0xC1, 0xE8, 0x08, 0x83,
    0xE0, 0x01, 0x8B, 0xD8, 0x8D, 0x04, 0x09, 0x83, 0xC3, 0x04, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x25, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x10, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04, 0x41, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x85, 0xC9, 0x0F, 0x84, 0x40, 0x01, 0x00, 0x00, 0x03, 0xC0, 0x4B, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x25, 0xFF, 0x00, 0x00,
    0x00, 0x75, 0x12, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04, 0x41, 0x8B, 0xD0, 0xC1, 0xEA, 0x08, 0x83, 0xE2, 0x01, 0x8B, 0xCA, 0x8D, 0x1C, 0x59, 0x8D, 0x4B, 0xF7, 0x85, 0xC9, 0x0F, 0x85, 0x0E, 0x01, 0x00, 0x00, 0xBA, 0x03, 0x00, 0x00, 0x00, 0x03, 0xC0, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x25, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x10, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04,
    0x41, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x4A, 0x8D, 0x2C, 0x69, 0x79, 0xD9, 0x8A, 0x16, 0x33, 0xC9, 0x8A, 0x4E, 0x01, 0x88, 0x17, 0x88, 0x4F, 0x01, 0x8A, 0x56, 0x02, 0x33, 0xC9, 0x83, 0xC7, 0x04, 0x8A, 0x4E, 0x03, 0x83, 0xC6, 0x04, 0x88, 0x57, 0xFE, 0x88, 0x4F, 0xFF, 0x45, 0x85, 0xED, 0x0F, 0x8C, 0xB8, 0xFE, 0xFF, 0xFF, 0x45, 0x8A, 0x16, 0x33, 0xC9, 0x8A, 0x4E, 0x01,
    0x88, 0x17, 0x88, 0x4F, 0x01, 0x8A, 0x56, 0x02, 0x33, 0xC9, 0x83, 0xC7, 0x04, 0x8A, 0x4E, 0x03, 0x88, 0x57, 0xFE, 0x88, 0x4F, 0xFF, 0x83, 0xC6, 0x04, 0x4D, 0x75, 0xDD, 0xE9, 0x8F, 0xFE, 0xFF, 0xFF, 0x8D, 0x04, 0x09, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x25, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x10, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04, 0x41, 0x8B, 0xC8, 0xC1, 0xE9, 0x08,
    0x83, 0xE1, 0x01, 0x85, 0xC9, 0x0F, 0x84, 0x69, 0x01, 0x00, 0x00, 0x03, 0xC0, 0xBB, 0x03, 0x00, 0x00, 0x00, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x25, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x12, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04, 0x41, 0x8B, 0xD0, 0xC1, 0xEA, 0x08, 0x83, 0xE2, 0x01, 0x8B, 0xCA, 0x85, 0xC9, 0x74, 0x3A, 0x33, 0xDB, 0x8A, 0x1E, 0x46, 0x85, 0xDB, 0x75, 0x2E,
    0x03, 0xC0, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x25, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x10, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04, 0x41, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x85, 0xC9, 0x0F, 0x84, 0xAD, 0x01, 0x00, 0x00, 0xE9, 0x02, 0xFE, 0xFF, 0xFF, 0x83, 0xC3, 0x08, 0x03, 0xC0, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x25, 0xFF, 0x00, 0x00, 0x00,
    0x75, 0x12, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04, 0x41, 0x8B, 0xD0, 0xC1, 0xEA, 0x08, 0x83, 0xE2, 0x01, 0x8B, 0xCA, 0x85, 0xC9, 0x0F, 0x84, 0xD8, 0x00, 0x00, 0x00, 0x03, 0xC0, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x25, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x10, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04, 0x41, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x03, 0xC0, 0x8B,
    0xD1, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x25, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x10, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04, 0x41, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x85, 0xC9, 0x74, 0x54, 0x8D, 0x2C, 0x00, 0x8B, 0xCD, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x81, 0xE5, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x12, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x2C, 0x41, 0x8B,
    0xC5, 0xC1, 0xE8, 0x08, 0x83, 0xE0, 0x01, 0x8B, 0xC8, 0x8D, 0x44, 0x2D, 0x00, 0x8D, 0x14, 0x51, 0x8B, 0xC8, 0x83, 0xCA, 0x04, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x25, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x10, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x04, 0x41, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x85, 0xC9, 0x75, 0x33, 0xEB, 0x09, 0x85, 0xD2, 0x75, 0x2D, 0xBA, 0x01, 0x00, 0x00,
    0x00, 0x03, 0xC0, 0x8B, 0xE8, 0xC1, 0xED, 0x08, 0x83, 0xE5, 0x01, 0x25, 0xFF, 0x00, 0x00, 0x00, 0x75, 0x13, 0x33, 0xC0, 0x8A, 0x06, 0x46, 0x8D, 0x44, 0x45, 0x00, 0x8B, 0xC8, 0xC1, 0xE9, 0x08, 0x83, 0xE1, 0x01, 0x8B, 0xE9, 0x8D, 0x54, 0x55, 0x00, 0x33, 0xC9, 0x8A, 0xEA, 0xC1, 0xEA, 0x08, 0x0B, 0xD1, 0x8B, 0xEA, 0x33, 0xD2, 0x81, 0xE5, 0x00, 0xFF, 0x00, 0x00, 0x8A, 0x16, 0x8B, 0xCD,
    0x8B, 0xEA, 0x8B, 0xD3, 0x0B, 0xE9, 0x8B, 0xCF, 0x2B, 0xCD, 0x46, 0x83, 0xE2, 0x01, 0x49, 0xD1, 0xEB, 0x85, 0xD2, 0x74, 0x08, 0x33, 0xD2, 0x8A, 0x11, 0x41, 0x88, 0x17, 0x47, 0x4B, 0x85, 0xED, 0x74, 0x41, 0x33, 0xD2, 0x83, 0xC7, 0x02, 0x8A, 0x11, 0x83, 0xC1, 0x02, 0x89, 0x54, 0x24, 0x10, 0x8A, 0x51, 0xFF, 0x88, 0x57, 0xFF, 0x8A, 0x54, 0x24, 0x10, 0x88, 0x57, 0xFE, 0x4B, 0x85, 0xDB,
    0x0F, 0x8C, 0xAA, 0xFC, 0xFF, 0xFF, 0x8D, 0x6B, 0x01, 0x8A, 0x59, 0x01, 0x33, 0xD2, 0x8A, 0x11, 0x88, 0x5F, 0x01, 0x88, 0x17, 0x83, 0xC1, 0x02, 0x83, 0xC7, 0x02, 0x4D, 0x75, 0xEB, 0xE9, 0x8D, 0xFC, 0xFF, 0xFF, 0x33, 0xD2, 0x81, 0xE5, 0x00, 0xFF, 0x00, 0x00, 0x8A, 0x11, 0x83, 0xC7, 0x02, 0x8B, 0xCA, 0x0B, 0xCD, 0x4B, 0x88, 0x4F, 0xFE, 0x88, 0x4F, 0xFF, 0x85, 0xDB, 0x0F, 0x8C, 0x6D,
    0xFC, 0xFF, 0xFF, 0x8D, 0x53, 0x01, 0x88, 0x0F, 0x88, 0x4F, 0x01, 0x83, 0xC7, 0x02, 0x4A, 0x75, 0xF5, 0xE9, 0x5A, 0xFC, 0xFF, 0xFF, 0x5F, 0x5E, 0x5D, 0x5B, 0x81, 0xC4, 0x88, 0x00, 0x00, 0x00, 0xC3,
};

int toBigEndian(unsigned long num) {
	return ((num & 0x000000ff) << 24)|((num & 0x0000ff00) << 8)|((num & 0x00ff0000) >> 8)|((num & 0xff000000) >> 24);
}

int main(int argc, char** argv) {
	puts("Travellers Tales RAW decompression tool by @Juanmv94");
	if (argc<2) {
		puts("Drag file to this executable, or pass it's name as parameter");
		return 0;
	}
	FILE* input = fopen(argv[1], "rb");
	char* outputname=malloc(strlen(argv[1])+9);
	//FILE* output = fopen("out", "wb");
	unsigned long beuncompressedSize,becompressedSize,uncompressedSize,compressedSize,counter=0;
	fread(&beuncompressedSize, 4, 1, input);
	while (beuncompressedSize!=0xFFFFFFFF) {
		uncompressedSize=toBigEndian(beuncompressedSize);
		fread(&becompressedSize, 4, 1, input);
		compressedSize=toBigEndian(becompressedSize);
		sprintf(outputname,"%s-%03d.bin",argv[1],++counter);
		printf("Inflating %s %d->%d\n",outputname,compressedSize,uncompressedSize);
		void* i = malloc(compressedSize+0x0E);
		void* o = malloc(uncompressedSize);
		memcpy(i,&beuncompressedSize,4);
		memcpy(i+4,&becompressedSize,4);
		fread(i+8, 6+compressedSize, 1, input);
		((void (*)(void*,void*))decoderawfunc)(i, o);
		FILE* output = fopen(outputname, "wb");
		fwrite(o,uncompressedSize,1,output);
		fclose(output);
		free(i);
		free(o);
		fread(&beuncompressedSize, 4, 1, input);
	}
	free(outputname);
	fclose(input);
	return 0;
}